(function(){function map(a,b){var c=a.length;if(typeof b!="function")throw new TypeError();var d=new Array(c);var e=arguments[2];for(var i=0;i<c;i++){if(i in a)d[i]=b.call(e,a[i],i,a)}return d}function filter(a,b){var c=a.length;if(typeof b!="function")throw new TypeError();var d=new Array();var e=arguments[2];for(var i=0;i<c;i++){if(i in a){var f=a[i];if(b.call(e,f,i,a))d.push(f)}}return d};function slice(a,b,c,d){var e=a.length,results=[];c=c||e;b=(b<0)?Math.max(0,b+e):Math.min(e,b);c=(c<0)?Math.max(0,c+e):Math.min(e,c);for(var i=b;i<c;i+=d){results.push(a[i])}return results}function expand(c,d){var e=[];function walk(a){if(d){if(d===true&&!(a instanceof Array)){e.push(a)}else if(a[d]){e.push(a[d])}}for(var i in a){var b=a[i];if(!d){e.push(b)}else if(b&&typeof b=='object'){walk(b)}}}if(d instanceof Array){if(d.length==1){return c[d[0]]}for(var i=0;i<d.length;i++){e.push(c[d[i]])}}else{walk(c)}return e}function distinctFilter(a,b){var c=[];var d={};for(var i=0,l=a.length;i<l;++i){var e=a[i];if(b(e,i,a)){if((typeof e=='object')&&e){if(!e.__included){e.__included=true;c.push(e)}}else if(!d[e+typeof e]){d[e+typeof e]=true;c.push(e)}}}for(i=0,l=c.length;i<l;++i){if(c[i]){delete c[i].__included}}return c}var m=function(e,f){tokens=[];var g=0;var h=[];e=e.replace(/"(\\.|[^"\\])*"|'(\\.|[^'\\])*'|[\[\]]/g,function(t){g+=t=='['?1:t==']'?-1:0;return(t==']'&&g>0)?'`]':(t.charAt(0)=='"'||t.charAt(0)=="'")?"`"+(h.push(t)-1):t});var j='';function call(a){j=a+"("+j}function makeRegex(t,a,b,c,d){return h[d].match(/[\*\?]/)||c=='~'?"/^"+h[d].substring(1,h[d].length-1).replace(/\\([btnfr\\"'])|([^\w\*\?])/g,"\\$1$2").replace(/([\*\?])/g,".$1")+(c=='~'?'$/i':'$/')+".test("+a+")":t}e.replace(/(\]|\)|push|pop|shift|splice|sort|reverse)\s*\(/,function(){throw new Error("Unsafe function call");});e=e.replace(/([^=]=)([^=])/g,"$1=$2").replace(/@|(\.\s*)?[a-zA-Z\$_]+(\s*:)?/g,function(t){return t.charAt(0)=='.'?t:t=='@'?"$obj":(t.match(/:|^(\$|Math|true|false|null)$/)?"":"$obj.")+t}).replace(/\.?\.?\[(`\]|[^\]])*\]|\?.*|\.\.([\w\$_]+)|\.\*/g,function(t,a,b){var c=t.match(/^\.?\.?(\[\s*\^?\?|\^?\?|\[\s*==)(.*?)\]?$/);if(c){var d='';if(t.match(/^\./)){call("expand");d=",true)"}call(c[1].match(/\=/)?"map":c[1].match(/\^/)?"distinctFilter":"filter");return d+",function($obj){return "+c[2]+"})"}c=t.match(/^\[\s*([\/\\].*)\]/);if(c){return".concat().sort(function(a,b){"+c[1].replace(/\s*,?\s*([\/\\])\s*([^,\\\/]+)/g,function(t,a,b){return"var av= "+b.replace(/\$obj/,"a")+",bv= "+b.replace(/\$obj/,"b")+";if(av>bv||bv==null){return "+(a=="/"?1:-1)+";}\n"+"if(bv>av||av==null){return "+(a=="/"?-1:1)+";}\n"})+"})"}c=t.match(/^\[(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)\]/);if(c){call("slice");return","+(c[1]||0)+","+(c[2]||0)+","+(c[3]||1)+")"}if(t.match(/^\.\.|\.\*|\[\s*\*\s*\]|,/)){call("expand");return(t.charAt(1)=='.'?",'"+b+"'":t.match(/,/)?","+t:"")+")"}return t}).replace(/(\$obj\s*(\.\s*[\w_$]+\s*)*)(==|~)\s*`([0-9]+)/g,makeRegex).replace(/`([0-9]+)\s*(==|~)\s*(\$obj(\s*\.\s*[\w_$]+)*)/g,function(t,a,b,c,d){return makeRegex(t,c,d,b,a)});e=j+(e.charAt(0)=='$'?"":"$")+e.replace(/`([0-9]+|\])/g,function(t,a){return a==']'?']':h[a]});var k=eval("1&&function($,$1,$2,$3,$4,$5,$6,$7,$8,$9){var $obj=$;return "+e+"}");for(var i=0;i<arguments.length-1;i++){arguments[i]=arguments[i+1]}return f?k.apply(this,arguments):k};if(typeof namespace=="function"){namespace("json::JSONQuery",m)}else{window["JSONQuery"]=m}})();